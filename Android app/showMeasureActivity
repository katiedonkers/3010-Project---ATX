package com.example.katie.atx;

import android.content.Intent;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.widget.Button;
import android.widget.TextView;
import android.view.View;

public class showMeasureActivity extends AppCompatActivity {

    TextView textView;
    String usernamex;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_show_measure);

        System.out.println("we are in show measure");
        Intent intent = getIntent();
        String message = intent.getStringExtra(UdpSend.EXTRA_MESSAGE);

        //Display username
        TextView textView2 = findViewById(R.id.NameOnMeasPage);
        usernamex = message.substring(1, 10 );
        String username = message;
        textView2.setText("Username: " + username.substring(1, 10 ));

        //Display Measurements
         textView = findViewById(R.id.measurementText);
        textView.setText("Length: " + message.substring(11, 12) + "\n Wrist Circumference: " + message.substring(12, 13) + "\n Elbow Circumference: " + message.substring(13, 14));

    }

    public void startMeasureButton(View view){
        System.out.println("We are startMeasureButton function");

        UdpSendPi cls = new UdpSendPi();
        System.out.println("creating thread udp send");
        Thread thread = new Thread(cls);
        System.out.println("about to start thread");
        thread.start();
        System.out.println("thread started");
        
        //##################### START OF CODE ############################
          String popup1 = "Taking your new measurements! Stay tuned...";
          String popup2 = "$$ ENjoy your fresh new measurements $$";
          Snackbar mySnackbar = Snackbar.make(findViewById(R.id.myCoordinatorLayout), popup1,Snackbar.LENGTH_LONG);
          mySnackbar.show();
         try {
              Thread.sleep(80000); //wait enough for system to have measurements rdy
          } catch (InterruptedException e) {
              e.printStackTrace();
          }
          
         String msg = cls.getMsg();
         mySnackbar = Snackbar.make(findViewById(R.id.myCoordinatorLayout), popup1,Snackbar.LENGTH_LONG);         
         textView.setText("Length: " + msg.substring(0, 1) + "\n Wrist Circumference: " + msg.substring(1, 2) + "\n Elbow Circumference: " + msg.substring(2, 3));
         mySnackbar.show();
         
         //################# SENDING BACK TO DATABASE ###################
         //MIGHT NEED MORE TIME TO POWER UP THE DATABASE PI AGAIN
         try {
              Thread.sleep(80000); 
          } catch (InterruptedException e) {
              e.printStackTrace();
          } 
          
        UDPAndroidToDB clsDB = new UDPAndroidToDB("3"+usernamex+msg.substring(0, 1)+msg.substring(1, 2)+msg.substring(2, 3));
        System.out.println("creating thread UDPAndroidToDB");
        Thread thread2 = new Thread(clsDB);
        thread2.start();
        System.out.println("thread UDPAndroidToDB started");
        
        //############# END OF NEW CODE #################################

    }
}
